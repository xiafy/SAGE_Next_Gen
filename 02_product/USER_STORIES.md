# USER_STORIES.md — 用户故事

> 版本: v1.0
> 日期: 2026-02-25
> 格式: As a [用户] / I want to [目标] / So that [价值] + 验收条件

---

## 第一组：首次使用（初体验）

---

**US-001 无摩擦启动**
> As a 第一次使用 SAGE 的旅行者,
> I want to 打开 App 后无需注册/登录直接开始,
> So that 我在餐厅等菜单的时候不会因为繁琐的注册流程放弃使用。

验收条件：
- [ ] 打开 URL 后，2 秒内看到可操作的主界面
- [ ] 无任何注册/登录弹窗
- [ ] 两个入口清晰可见

---

**US-002 语言自动适配**
> As a 英文系统手机用户的 Sarah,
> I want to 打开 App 后界面自动显示英文,
> So that 我不需要去设置里改语言。

验收条件：
- [ ] 系统语言为中文 → 界面显示中文
- [ ] 系统语言为英文/其他 → 界面显示英文
- [ ] 可手动在界面内切换语言

---

## 第二组：扫描菜单路径

---

**US-003 拍照无缝进入对话**
> As a 坐在泰国餐厅的阿明,
> I want to 拍完菜单照片后立刻进入 AI 对话，不用等识别完成,
> So that 等待识别的时间不会让我感到无聊或焦虑。

验收条件：
- [ ] 图片上传后立即跳转到 AgentChat
- [ ] 跳转后 AI 先发出 icebreaker（如"菜单正在识别中，你有什么饮食偏好先告诉我？"）
- [ ] 识别完成后 AI 自动续上对话，不打断用户

---

**US-004 从相册上传已有照片**
> As a 已经拍好菜单照片的旅行者,
> I want to 从相册选择已有的菜单照片,
> So that 不需要重新拍摄。

验收条件：
- [ ] Image Picker 提供「相册选择」选项
- [ ] 支持 JPG/PNG/HEIC 格式
- [ ] 选择后与拍照流程完全一致

---

**US-005 相机权限被拒时的降级**
> As a 没有给浏览器相机权限的用户,
> I want to 看到清晰的引导说明，并且还能用相册上传,
> So that 权限问题不会完全阻断我使用 SAGE。

验收条件：
- [ ] 权限被拒时显示引导（如何在系统设置中开启）
- [ ] 「从相册选择」在权限被拒的情况下仍然可用
- [ ] 不 crash，不白屏

---

**US-006 多张菜单图片**
> As a 拿到酒单和食物菜单两本的旅行者,
> I want to 把两张照片都上传,
> So that AI 能同时理解完整的餐饮选项。

验收条件：
- [ ] 一次可选择最多 5 张图片
- [ ] AI 识别时自动合并，按类别整合（食物/酒水/甜品）
- [ ] 合并后重复菜品自动去重

---

## 第三组：AI 对话决策

---

**US-007 AI 主动开口推荐**
> As a 不知道怎么开口问 AI 的阿明,
> I want to AI 识别完菜单后主动介绍并推荐，不等我先说,
> So that 我不需要想怎么提问，直接看 AI 说什么就好。

验收条件：
- [ ] 菜单识别完成后，AI 立即发出主动开场（不等用户输入）
- [ ] 开场包含：餐厅类型简介 + 2-3 个推荐菜 + 引导性问题
- [ ] 开场不超过 3 句话（简洁）

---

**US-008 快捷按钮引导决策**
> As a 不想打字的用户,
> I want to 看到 AI 给出的几个快捷选项直接点,
> So that 懒得打字的时候也能快速推进对话。

验收条件：
- [ ] 每次 AI 回复后，显示 2-4 个上下文相关的快捷按钮
- [ ] 快捷按钮内容由 AI 动态生成（非固定选项）
- [ ] 点击快捷按钮等同于发送该文字

---

**US-009 表达饮食偏好**
> As a 对花生过敏的 Sarah,
> I want to 告诉 AI 我的过敏情况,
> So that 推荐的菜品不包含花生，我不用担心踩雷。

验收条件：
- [ ] AI 在推荐时主动规避已知过敏原
- [ ] 如果菜单菜品均含过敏原，AI 主动说明并建议替代
- [ ] 过敏信息被记入本地偏好记忆

---

**US-010 追问食材和文化背景**
> As a 想了解"鱼露"是什么的 Sarah,
> I want to 问 AI 某个食材是什么，有没有什么文化背景,
> So that 我点餐时心里有底，也能和同行朋友分享。

验收条件：
- [ ] AI 能回答任何菜品/食材的解释性问题
- [ ] 回答包含：食材说明 + 文化背景（如适用）+ 口味描述
- [ ] 回答简洁（≤ 4 句话），不过度堆砌信息

---

**US-011 辣度 / 口味偏好筛选**
> As a 不能吃太辣的阿明,
> I want to 说"我不要太辣"，AI 帮我过滤推荐,
> So that 不会点到不能吃的程度。

验收条件：
- [ ] AI 理解程度表达（微辣/中辣/不辣）并过滤推荐
- [ ] 如果菜单中无辣度信息，AI 主动说明无法确认并给出建议
- [ ] 偏好被记入本地记忆

---

**US-012 多人用餐场景**
> As a 和 3 位朋友一起用餐的阿明,
> I want to 告诉 AI 有几个人、有什么不同口味,
> So that 推荐的数量和搭配适合整桌。

验收条件：
- [ ] AI 询问或接受用餐人数信息
- [ ] 根据人数调整推荐数量（如 4 人推荐 6-8 道）
- [ ] 同桌不同偏好时，AI 提供覆盖性推荐

---

## 第四组：点餐单与服务员模式

---

**US-013 加入点餐单**
> As a 看到想点的菜的旅行者,
> I want to 一键把菜加入点餐单,
> So that 不用自己记，也不会漏掉。

验收条件：
- [ ] 推荐卡片上有「➕ 加入」按钮，一键操作
- [ ] 加入后按钮变为「✓ 已加入」，可点击取消
- [ ] 底部浮动入口显示当前数量，实时更新

---

**US-014 展示给服务员**
> As a 语言不通的旅行者,
> I want to 把点好的菜单用大字展示给服务员,
> So that 服务员能看懂我要点什么，不用我开口说。

验收条件：
- [ ] 点餐单内有「展示给服务员」按钮
- [ ] 展示模式：全屏、大字（推荐 28px+）、深色背景白字（高对比）
- [ ] 只显示菜品**原文**名称 + 数量（不显示翻译，给服务员看）
- [ ] 展示模式下屏幕不自动锁屏（保持亮屏）

---

**US-015 小费建议**
> As a 不熟悉当地小费习惯的 Sarah,
> I want to 知道这个国家/餐厅应该给多少小费,
> So that 不会因为不懂规矩而尴尬。

验收条件：
- [ ] 点餐单页面显示小费建议（如"美国餐厅通常 18-20%"）
- [ ] 小费数据按目的地国家显示（GPS 或用户手动选择）
- [ ] 无法确定地区时不显示小费建议（不瞎猜）

---

## 第五组：记忆与偏好

---

**US-016 下次自动记住我的偏好**
> As a 上次说了"不吃香菜"的阿明,
> I want to 下次打开 SAGE 时，AI 已经知道我不吃香菜，不用再说一遍,
> So that 每次用餐体验都在上次基础上进化，越来越懂我。

验收条件：
- [ ] 偏好记录存在 localStorage，关闭浏览器重开后仍存在
- [ ] 新 session 开始时，AI 自然融入已知偏好（不是机械念清单）
- [ ] AI 提及偏好的方式是自然对话，不是"系统提示：您的偏好如下"

---

**US-017 纠正 AI 的偏好记忆**
> As a 今天其实想尝试吃辣的阿明,
> I want to 告诉 AI"今天我想试试辣的"，AI 接受这个临时调整,
> So that 记忆系统有弹性，不会把我困在过去的偏好里。

验收条件：
- [ ] 用户临时表达与记忆相反的偏好，AI 在当次 session 优先使用
- [ ] 用户明确说"以后都可以接受辣的"，AI 更新长期偏好记录

---

## 第六组：异常与边界场景

---

**US-018 网络中断时的体验**
> As a 在信号不好的餐厅的旅行者,
> I want to 网络断了时看到友好的提示，而不是白屏崩溃,
> So that 不会以为 App 坏了而放弃使用。

验收条件：
- [ ] 网络中断时，已有对话内容不丢失
- [ ] 显示"网络连接中断，请检查信号"的提示
- [ ] 网络恢复后可以继续使用，不需要刷新

---

**US-019 AI 识别失败的降级体验**
> As a 用手机拍了一张模糊菜单的旅行者,
> I want to 识别失败时得到有用的反馈，而不是什么都不说,
> So that 我知道该怎么做（重拍/手动输入）。

验收条件：
- [ ] AI 识别失败时，给出具体原因（图片模糊/语言暂不支持/网络异常）
- [ ] 提供可操作的建议（重新拍摄/换张更清晰的图）
- [ ] 可以降级到「随便聊聊」模式，用文字描述代替菜单

---

**US-020 菜单语言不在支持范围内**
> As a 拿着阿拉伯语菜单的旅行者,
> I want to 知道 SAGE 目前不支持这种语言，并得到替代方案,
> So that 不会对着空白结果不知所措。

验收条件：
- [ ] AI 识别出不支持的语言时，明确告知
- [ ] 提供建议：可以拍照后用文字描述给 AI 或切换到对话模式
- [ ] 不 crash，不返回乱码

---

## 用户故事覆盖矩阵

| 功能模块 | 相关用户故事 |
|---------|------------|
| F01 Home | US-001, US-002 |
| F02 Image Picker | US-003, US-004, US-005, US-006 |
| F03 菜单识别 | US-003, US-019, US-020 |
| F04 感知体系 | US-016, US-017 |
| F05 动态角色 | US-007 |
| F06 AgentChat | US-007, US-008, US-009, US-010, US-011, US-012 |
| F07 探索视图 | US-010 |
| F08 点餐单 | US-013, US-014, US-015 |
| F09 偏好记忆 | US-009, US-011, US-016, US-017 |
| 异常处理 | US-018, US-019, US-020 |
