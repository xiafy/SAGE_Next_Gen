# 三层质量审查方法论

> 版本: v1.0
> 日期: 2026-03-01
> 制定人: Mr. Xia / SAGE Agent
> 用途: 产品质量保障的标准审查流程，适用于任何阶段的全面质量检查

---

## 核心原则

**自上而下、层层传导**——上层的缺陷不在下层修补，而是回到上层修正后再向下传导。上层没闭环，不进下一层。

---

## 第一层：需求层

**目标**：确保我们在解决真实的问题，为真实的用户，覆盖真实的场景。

**审查对象**：
- 产品愿景（vision）
- 产品需求文档（PRD）
- 用户故事（user stories）
- 竞品分析

**审查维度**：

| 维度 | 核心问题 | 判断标准 |
|------|---------|---------|
| 场景真实性 | 用户画像和旅程是否覆盖了真实场景的关键变量？ | 能否在真实环境中找到对应场景 |
| 需求完整性 | 是否有"用户会做但我们没考虑到"的场景缺口？ | 走完一次真实用户旅程，每一步都有定义 |
| 逻辑一致性 | 各功能之间是否有矛盾或重叠？文档与代码是否一致？ | 任意两个文档不存在互相矛盾的描述 |
| 优先级合理性 | MVP 边界是否清晰？砍掉的东西是否真的可以砍？ | 被砍的功能不会被其他功能隐式依赖 |

**产出**：需求问题清单（按 🔴🟡🟢 分级）+ 修订建议

---

## 第二层：规格层

**目标**：确保每一个需求都有充分、无歧义的设计规范，足以让任何开发者独立实现。

**前置条件**：第一层问题已闭环。

**审查对象**：
- 系统架构（architecture）
- API 契约（api-design）
- 状态机设计（state machine）
- 导航规范（navigation）
- 视觉设计规范（visual design）
- 各功能详细规格（specs/）

**审查维度**：

| 维度 | 核心问题 | 判断标准 |
|------|---------|---------|
| 流程闭环 | 每条用户路径是否有明确的入口、出口和错误恢复？ | 画出状态流图，无死胡同、无悬空状态 |
| 状态机完备性 | 每个状态 × 每个事件是否都有定义？ | 不存在"未定义行为" |
| API 契约清晰度 | 请求/响应/错误码是否足以让人独立实现？ | 不需要"问一下原作者"就能写出对接代码 |
| 边界条件 | 超时、空数据、极端输入、并发操作是否有规范？ | 每个输入字段都有 min/max/empty/null 的处理定义 |
| 需求追溯性 | 每条规格能追溯到某个需求？有没有"无主规格"或"无规格的需求"？ | 需求 → 规格 双向可追溯 |

**产出**：规格缺口清单 + 需要补写/修订的规格文档

---

## 第三层：执行层

**目标**：确保代码和测试忠实于规格，质量可验证。

**前置条件**：第二层问题已闭环。

**审查对象**：
- 前端源码
- 后端源码（Worker）
- E2E 测试
- 测试文档和用例

**审查维度**：

| 维度 | 核心问题 | 判断标准 |
|------|---------|---------|
| 代码 vs 规格一致性 | 代码行为是否忠实于规格文档？ | 逐条 AC 对照，代码行为与规格描述一致 |
| 错误处理覆盖 | 规格中定义的每个错误路径，代码中是否有对应处理？ | 无静默吞错、无未处理异常 |
| 测试覆盖 | 测试用例是否覆盖了规格中的所有 AC？ | 每条 AC 至少有一个对应测试 |
| 技术债 | 有哪些 TODO/HACK/临时方案？ | 技术债有记录、有清理计划 |

**产出**：代码问题清单 + 测试覆盖差距分析

---

## 执行流程

```
Phase 1: 需求层审查
    ↓ 产出问题清单 → 与决策者共识 → 修订文档
    ↓ 确认闭环
Phase 2: 规格层审查
    ↓ 产出缺口清单 → 补写/修订规格 → 确认闭环
    ↓ 确认闭环
Phase 3: 执行层审查
    ↓ 代码对照 → 测试补全 → 技术债清理
    ↓ 审查完成
```

每个 Phase 结束时必须与决策者确认问题清单、达成共识后才能进入下一层。

---

## 适用场景

- **版本发布前**：完整走一遍三层审查
- **重大功能上线**：对该功能走三层审查
- **定期健康检查**：每月/每 Sprint 结束时做一次轻量审查
- **新成员/新 Agent 入场**：用三层审查快速理解项目质量现状

---

## 严重度分级

| 级别 | 含义 | 处理要求 |
|------|------|---------|
| 🔴 关键 | 影响产品逻辑或用户信任 | 必须在当前阶段修复，不进下一层 |
| 🟡 重要 | 不完整但不阻塞核心流程 | 本轮修复或明确标注为 Future |
| 🟢 次要 | 打磨优化项 | 记录，按优先级排期 |
