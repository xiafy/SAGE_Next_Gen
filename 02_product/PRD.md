# PRD — 产品需求文档

> 版本: v1.2
> 日期: 2026-02-25
> 状态: 🟢 MVP 范围已确认（Mr. Xia 审阅完成）
> 上游文档: `01_strategy/VISION.md v1.1`

---

## 0. 阅读指引

本文档定义 SAGE Next Gen 的**MVP 功能规格**。

- 功能优先级标签：`[MVP]` / `[Sprint 2]` / `[Future]`
- 每个功能模块包含：用户目标、功能描述、验收标准（AC）、边界条件
- 技术实现细节不在本文档，见 `04_technical/`

---

## 1. 产品概述

SAGE 是面向全球旅行者的餐饮智能体。

**核心价值主张**：在菜单超过 30% 是非母语的陌生餐厅，帮用户通过 ≤3 轮 AI 对话完成点餐决策。

**MVP 范围**：
- 用户群：中国旅行者 + 英语系欧美旅行者
- 形态：手机 Web App，无需下载，无需登录
- 语言：中英双语 UI（系统语言自动切换）
- **用户路径：仅实现 Path A（扫描菜单 → AI 对话 → 点餐单）**
- Path B（随便聊聊）、Path C（补充菜单）移入 Backlog，MVP 不实现

---

## 2. 用户画像

### Persona A：阿明（中国旅行者）
- **背景**：30 岁，上海互联网从业者，每年出境 3-4 次（日韩东南亚为主）
- **场景**：在曼谷夜市，菜单全是泰文，旁边没有英文对照，同行朋友也看不懂
- **现有行为**：拍照发给 ChatGPT 翻译，但要来回切换 App，且只能翻译不能推荐
- **核心诉求**：快速知道"这里有什么"和"我应该点什么"
- **痛点**：翻译工具只翻译，不推荐；通用 AI 太慢、操作步骤多；语言不通导致尴尬
- **设备**：iPhone，微信重度用户，不愿安装新 App

### Persona B：Sarah（美国旅行者）
- **背景**：28 岁，纽约设计师，第一次去日本旅行
- **场景**：在东京居酒屋，菜单全是日文，服务员英语有限
- **现有行为**：用 Google Lens 翻译，但只有文字，不知道菜是什么样、适不适合自己
- **核心诉求**：了解菜品文化背景，避免踩雷（过敏、口味不合），选出自己会喜欢的
- **痛点**：不了解日本饮食文化；担心不小心点了不能吃的东西；想要"当地人推荐"感
- **设备**：Android，Safari/Chrome 用户

---

## 3. 核心用户旅程

### 旅程 A：扫描菜单路径（主路径）`[MVP 唯一实现路径]`

```
[进入 App]
    ↓
[Home 双入口]
    ↓ 点击"扫描菜单"
[Image Picker]（拍照 或 从相册选）
    ↓ 选择图片后立即跳转（不等待识别完成）
[AgentChat]
    ├─ AI 正在识别菜单（加载状态 + icebreaker 对话）
    ├─ 识别完成 → AI 主动开口介绍 + 推荐
    └─ 用户提问 / 筛选 / 追问
         ↓
    [加入点餐单]
         ↓
    [点餐单确认] → [展示给服务员模式]
```

### 旅程 B：直接对话路径 `[Backlog — MVP 不实现]`

> 场景示例：在路上问"泰国菜我该注意什么"、发送餐厅名称请 AI 推荐菜品等。
> MVP 完成 Path A 闭环验证后再规划。

### 旅程 C：补充菜单路径 `[Backlog — MVP 不实现]`

> 场景：已在对话中途，再补拍酒单或甜品单合并到当前菜单。
> MVP 阶段用户可重新发起新的 Path A 流程代替。

---

## 4. 功能规格

---

### F01 — Home 双入口

**用户目标**：打开 App 后 1 秒内理解能做什么，做出选择。

**功能描述**：
- 主入口：「📷 扫描菜单」（MVP 唯一激活入口）
- 「💬 随便聊聊」入口：MVP 中**不实现**，可显示为灰色或暂不显示
- 动态问候语（基于当前时段：早安/午好/晚好/深夜好）
- 无需任何注册/登录步骤，打开即用

**验收标准（AC）**：
- AC1: 首屏加载完成到用户可交互 < 2 秒（4G 网络）
- AC2: 两个入口在主流手机屏幕（375px-430px 宽）下清晰可见，无需滚动
- AC3: 语言根据系统语言自动显示（中文系统→中文，其他→英文）
- AC4: 不显示任何注册/登录引导

**优先级**：`[MVP]`

---

### F02 — Image Picker（Chat-Native 风格）

**用户目标**：以最少步骤将菜单照片交给 AI，不被打断到其他页面。

**功能描述**：
- **不是独立全屏页面**，是 Chat 输入栏的原生附件功能
- 底部弹出选择面板：「📷 拍照」和「🖼 从相册选择」
- 选择图片后在输入栏上方显示缩略图预览
- 确认后发送，立即跳转 AgentChat 并开始识别

**验收标准**：
- AC1: 从点击「扫描菜单」到进入 AgentChat < 3 秒（不含 AI 识别时间）
- AC2: 支持 JPG/PNG/HEIC 格式
- AC3: 支持多张图片（一次最多 5 张，用于食物菜单、酒单、甜品单、套餐规则等分开拍摄）
- AC4: 图片上传前压缩至 < 2MB（不影响 OCR 质量）
- AC5: 相机权限被拒绝时，显示引导说明，且「从相册选择」仍可用

**优先级**：`[MVP]`

---

### F03 — 菜单识别（AI Vision）

**用户目标**：AI 能准确理解菜单内容，为后续推荐提供可靠基础。

**功能描述**：
- 调用 AI Vision API 识别菜单图片
- 提取内容：菜品名称（原文 + 翻译）、价格、描述、分类、食材关键词
- 同时输出：`menuType`（正餐/酒单/甜品/快餐/其他）、`detectedLanguage`、`priceLevel`（1-3 档）
- 根据 `menuType` 动态决定 AI 角色（见 F05）
- 识别过程中 AgentChat 不阻塞，显示 loading 状态

**验收标准**：
- AC1: 支持语言：中/英/日/韩/泰/法/西/意/德（MVP 核心语言集）
- AC2: 标准印刷菜单识别成功率 ≥ 90%（测试集：M1-M10 标准场景）
- AC3: 识别时间 < 10 秒（P90，正常网络）
- AC4: 识别失败时（网络/API 异常）显示友好错误提示，提供重试或手动输入选项
- AC5: AI 返回内容必须通过 zod schema 校验，异常时降级到基础对话模式
- AC6: 识别结果不直接以列表形式展示（对话驱动，不是列表驱动）

**优先级**：`[MVP]`

---

### F04 — 4+1 维感知数据采集

**用户目标**：AI 能理解我当下的完整场景，而不只是菜单内容。

#### F04-A 时间感知 `[MVP]`
- 自动读取设备系统时间
- 注入 AI 上下文（早餐/午餐/晚餐/夜宵时段判断）

#### F04-B 空间感知 `[MVP]`
- **进入 App 时立即请求** GPS 位置授权（不延迟到扫描菜单时）
- 权限被拒时跳过，不阻断主流程
- 注入 AI 上下文（大致区域，不精确到街道）

#### F04-C 天气感知 `[Sprint 2]`
- 获取当前位置天气（需 GPS）
- 注入 AI 上下文

#### F04-D 历史记忆 `[MVP]`
- localStorage 存储用户偏好信号
- 偏好信号来源：用户在对话中明确表达的偏好（"我不吃香菜"）
- 自动从对话中提炼关键词并存储
- 下次打开时注入 AI 上下文（"上次你说不吃香菜…"）
- 存储上限：最近 50 条偏好记录，FIFO 淘汰

**验收标准**：
- AC1: 感知数据采集失败（权限拒绝/网络异常）时，主流程不中断
- AC2: 用户不感知"数据采集"的存在，Context 注入对用户透明
- AC3: 历史记忆在同一浏览器/设备上跨 session 持久

---

### F05 — 动态 AI 角色系统

**用户目标**：AI 的语气和知识结构匹配当前餐厅类型，感觉像"真正的专家"。

**功能描述**：
- 菜单类型 → AI 角色 → 开场白风格（全部由 AI 动态生成，不硬编码）
- 角色示例（非固定，仅供理解）：
  - 酒单 → 侍酒师风格
  - 正餐（法式/日式高端）→ 美食顾问风格
  - 泰国街头菜单 → 轻松的本地向导风格
  - 快餐 → 简洁高效风格

**验收标准**：
- AC1: 不同菜单类型下，AI 开场白语气明显不同
- AC2: 角色不在代码中硬编码（通过 Prompt 工程实现）
- AC3: 同一餐厅场景下角色保持一致，不在对话中途突变

**优先级**：`[MVP]`

---

### F06 — AgentChat 对话界面

**用户目标**：通过自然对话快速完成点餐决策，≤3 轮。

**功能描述**：
- 消息气泡（AI / 用户）
- **Icebreaker 机制**：图片上传后立即进入对话，AI 不等识别完成，先发 icebreaker 消息主动问询用户（如"菜单正在识别中，先告诉我你们几位用餐？有什么忌口吗？"），利用等待时间收集上下文，减少用户焦虑
- 识别完成后 AI 自动衔接 icebreaker 对话，给出完整开场推荐
- 快捷回复按钮（由 AI 动态生成，不硬编码）
- 菜品推荐内嵌在对话流中（不是独立列表页）
- 推荐卡片：菜名（原文 + 翻译）、价格、简短描述、「➕ 加入」按钮
- 对话历史在切换视图（查看菜单列表）后返回时不丢失

**验收标准**：
- AC1: AI 首次响应 < 5 秒（P90）
- AC2: 消息发送后输入栏立即清空，不等 AI 响应
- AC3: 快捷按钮由当前对话上下文动态生成，非固定选项
- AC4: 用户切换到「浏览全部」再返回，对话历史完整保留
- AC5: 网络中断时，已有对话内容不丢失

**优先级**：`[MVP]`

---

### F07 — 菜品探索视图（辅助入口）

**用户目标**：想自己浏览菜单时，有一个有组织的列表可以查看。

**功能描述**：
- 从 AgentChat 内进入（辅助路径，非主路径）
- 按 AI 识别的分类展示所有菜品（双语）
- 每道菜显示：原名、翻译、价格、简短 AI 描述
- 点击菜品查看详情（食材、过敏原、AI 文化注解）
- 「加入点餐单」按钮
- 「返回对话」按钮（随时回到 AgentChat）

**验收标准**：
- AC1: 探索视图内操作（加菜/查看详情）不丢失 AgentChat 对话历史
- AC2: 菜品分类由 AI 识别决定，不硬编码（如"招牌推荐"/"饮品"/"今日特供"）
- AC3: 返回 AgentChat 时滚动位置保持在最新消息处

**优先级**：`[MVP]`

---

### F08 — 点餐单与展示模式

**用户目标**：整理好点的菜，能展示给服务员看。

**功能描述**：
- 底部浮动点餐单入口（有菜品时显示，显示数量和总价）
- 点餐单页面：菜品列表、数量调整（+/-）、删除、小计
- **展示给服务员模式**：全屏大字显示菜品原文名称（服务员能看懂的语言）+ 数量
- 货币符号和价格格式自动适配（¥/$/€/฿ 等）
- 小费建议（根据国家习惯）

**验收标准**：
- AC1: 点餐单数量变化时总价实时更新
- AC2: 展示模式字号足够大（服务员隔着桌子能看清），推荐 24px+
- AC3: 展示模式中只显示原文菜名，不显示翻译（给服务员看的）
- AC4: 小费建议数据准确（美国 18-20%、泰国不需要等）

**优先级**：`[MVP]`

---

### F09 — 偏好学习与记忆

**用户目标**：SAGE 记住我的饮食习惯，下次不用重复说。

**功能描述**：
- 从对话中自动提炼偏好信号（正则 + AI 理解）
- 偏好类型：
  - 忌口（"我不吃香菜" "我对花生过敏"）
  - 口味倾向（"我喜欢辣的" "不要太油腻"）
  - 饮食限制（素食/清真/无麸质）
- 下次打开时，AI 在对话中自然提及（不是弹窗）
- 用户可以在对话中纠正/更新偏好

**验收标准**：
- AC1: 偏好存储到 localStorage，关闭浏览器重开后仍存在
- AC2: AI 在新 session 开始时，自然融入已知偏好（不是机械念清单）
- AC3: 用户说"其实我现在可以吃香菜了"，AI 更新偏好记录

**优先级**：`[MVP]`

---

### F10 — 语言切换

**用户目标**：界面语言符合我的母语习惯。

**功能描述**：
- 默认根据设备系统语言自动选择（中文系统→中文，其他→英文）
- 支持手动切换（设置入口或首次使用时询问）

**验收标准**：
- AC1: 自动检测准确率 100%（只需判断是否为中文系统）
- AC2: 切换语言后全部 UI 文案更新，无遗漏

**优先级**：`[MVP]`

---

## 5. 非功能性需求

| 类别 | 要求 |
|------|------|
| **性能** | 首屏可交互 < 2s（4G）；AI 首次响应 < 5s（P90）|
| **可用性** | 支持 iOS Safari 16+，Android Chrome 100+，不兼容桌面端（可降级显示提示）|
| **安全** | 所有 AI API Key 仅在服务器端；前端零 Key |
| **隐私** | 菜单图片不持久存储在服务器；用户历史数据仅存本地 |
| **离线** | 核心 UI 可离线加载（PWA 缓存）；AI 功能需网络，无网时显示友好提示 |
| **国际化** | UI 中英双语；AI 对话语言跟随用户语言；菜单识别支持 9 种核心语言 |

---

## 6. 不在 MVP 范围内

以下功能明确不做，防止范围蔓延：

| 功能 | 不做的理由 |
|------|----------|
| 用户账号/登录 | 增加摩擦，MVP 无需跨设备同步 |
| 云端记忆同步 | 技术复杂度高，本地存储足够验证价值 |
| 餐厅推荐/搜索 | 用户已在餐厅，不是找餐厅的工具 |
| 用餐后评价 | MVP 专注点餐决策，反馈闭环是第二阶段 |
| 社交分享 | 与核心价值无关 |
| 原生 App（iOS/Android）| Web 足以验证，App Store 审核增加周期 |
| 实时视频识别 | 技术成本高，静态拍照足够 |
| 第三方平台登录 | MVP 无账号体系，不需要 |

---

## 7. 功能优先级矩阵

| 功能 | 优先级 | 依赖 |
|------|--------|------|
| F01 Home 双入口 | 🔴 MVP | 无 |
| F02 Image Picker | 🔴 MVP | F01 |
| F03 菜单识别 | 🔴 MVP | F02 |
| F05 动态 AI 角色 | 🔴 MVP | F03 |
| F06 AgentChat | 🔴 MVP | F03、F05 |
| F04-A 时间感知 | 🔴 MVP | F06 |
| F04-B 空间感知 | 🔴 MVP | F06 |
| F04-D 历史记忆 | 🔴 MVP | F06 |
| F08 点餐单 | 🔴 MVP | F06 |
| F09 偏好学习 | 🔴 MVP | F06 |
| F07 探索视图 | 🟡 MVP（降级可接受）| F03 |
| F10 语言切换 | 🔴 MVP | 无 |
| F04-C 天气感知 | 🟢 Sprint 2 | F04-B |

---

## 8. 开放问题（待决策）

| # | 问题 | 影响 | 优先级 |
|---|------|------|--------|
| OQ1 | 免费试用次数 X = 多少？ | 定价/变现策略 | Sprint 2 前确定 |
| ~~OQ2~~ | ~~GPS 请求时机~~ | — | ✅ 已决策：进入 App 时立即请求（见 DEC-013）|
| OQ3 | 菜单识别使用哪个 AI Vision 模型？Claude Vision vs 其他？ | 成本/质量 | Sprint 1 技术选型确定 |
| OQ4 | 多张图片（最多 5 张）是同时提交识别还是逐张？ | API 成本/体验 | Sprint 1 技术选型确定 |
