# Core Loop Closure Plan v1 (No Paywall)

> Date: 2026-02-28
> Strategy: 先闭环核心业务流程，再考虑商业化（Paywall 暂缓）

## 0. 目标定义

核心闭环（必须端到端可用）：

**菜单输入（拍/聊） → AI 理解与推荐 → 下单卡确认 → 服务员模式展示 → 返回继续优化**

成功标准：
- 用户无需跳出流程即可完成“看菜单到下单表达”
- 任一步失败都有可恢复路径
- 关键路径可通过固定回归脚本/清单重复验证

---

## 1) 用户场景优先级（P0）

### S1. 首次到店（首次用户）
- 入口：Home → Scanner
- 期望：快速得到 2-3 个可执行建议 + 原因
- 闭环终点：进入 OrderCard 并能切到 WaiterMode 展示
- 验收：3 分钟内完成一次完整流程

### S2. 补充菜单（真实世界常见）
- 入口：Chat 中补拍（Path C）
- 期望：不丢历史偏好，菜单内容合并更新
- 闭环终点：推荐刷新并可继续追问
- 验收：补拍后推荐内容明显变化且无状态断裂

### S3. 多人决策（冲突处理）
- 输入：忌口/预算/口味冲突（如“有人怕辣+预算有限”）
- 期望：给折中方案 + 可替代项
- 闭环终点：可直接加入订单卡
- 验收：建议理由可解释且不违反忌口

---

## 2) 体验优化清单（P0/P1）

## P0（本轮）
1. **识别等待体验稳定化**
   - 统一阶段文案（识别中/分析中）
   - 避免“假进度”，保持状态机驱动
2. **推荐可执行性增强**
   - 每条推荐至少含：菜名 + 理由 + 适配偏好点
3. **错误恢复闭环**
   - 失败态提供明确下一步：重试 / 补拍 / 继续聊天

## P1（下一轮）
4. **OrderCard 完整度**
   - 数量调整、合计、空状态文案一致性
5. **WaiterMode 可用性细化**
   - 原文展示清晰、可快速返回

---

## 3) 功能闭环改造顺序（Spec → Test → Code）

### Batch A（先做）
- 目标：S1 首次到店闭环稳定
- Spec: `specs/core-loop-s1-first-visit.md`
- Test: `tests/core-loop-s1-checklist.md`
- Code: 仅修复阻断闭环的问题（不扩功能）

### Batch B
- 目标：S2 补拍闭环
- Spec: `specs/core-loop-s2-supplement.md`
- Test: `tests/core-loop-s2-checklist.md`
- Code: Path C 状态与推荐刷新

### Batch C
- 目标：S3 多人决策闭环
- Spec: `specs/core-loop-s3-group-decision.md`
- Test: `tests/core-loop-s3-checklist.md`
- Code: Prompt/推荐策略优化

---

## 4) 验收门禁（沿用 G1~G6）

- G1 Spec 完成
- G2 Test 清单可执行
- G3 Code 实施
- G4 本地预览通过
- G5 Build 通过
- G6 线上回归通过

附加门禁：
- 改公共组件必须全局回归
- 进度与动画必须映射状态机
- 失败路径必须可恢复

---

## 5) 本周建议输出

1. 完成 Batch A（S1）并上线
2. 形成一份《核心闭环验收记录》
3. 再进入 Batch B（S2）

Paywall（DEC-030）明确降级：在 S1/S2/S3 闭环全部稳定前不进入开发。