# Engineering Guardrails (Hotfix / UI Iteration)

> 生效时间：2026-02-28
> 目的：防止“快速修 bug”绕过既定研发纪律，保障质量与效率。

## 1) 强制流程（最小闭环）

任何页面改动（包括 UI/样式 hotfix）必须按以下顺序执行：

1. **Spec（最小规格）**
   - 在对应任务文档或 `specs/` 中补充最小 AC（可 5~15 行）。
   - 至少写清：问题、目标行为、验收标准（Before/After）。
2. **Test（最小验证）**
   - 至少一项可重复验证：
     - 本地人工用例清单（推荐）
     - 或自动化 smoke（Playwright / 单测）
3. **Code**
   - 实施改动。
4. **本地预览**
   - `npm run dev`，在目标页面走完验收路径。
5. **构建检查**
   - `npm run build` 必过。
6. **部署与回归**
   - 部署后验证线上行为。
   - 若“看起来没生效”，优先排查缓存（hash / 强刷 / 独立 deployment URL）。

---

## 2) 本次新增硬规则

1. **公共组件变更必须全局检查**
   - 改动 `TopBar/Button/Card/...` 后，必须全局 grep 使用点并逐页回归。
2. **进度动画必须绑定真实状态机**
   - 禁止纯装饰“假进度条”；要映射到业务阶段（如 `pre_chat → handing_off → chatting`）。
3. **`overflow-hidden` 风险检查**
   - 凡有浮层按钮（删除/角标/菜单）必须检查裁切与点击区域。
4. **先本地再部署**
   - 禁止“改完直接 deploy”。

---

## 3) PR / 提交前 Checklist

- [ ] 已补最小 Spec（含 AC）
- [ ] 已定义最小 Test（人工或自动化）
- [ ] `npm run dev` 本地预览通过
- [ ] `npm run build` 通过
- [ ] 公共组件改动已全局回归
- [ ] 线上验证通过（含缓存排查）

---

## 4) 与现有决策对齐

- 对齐 **DEC-035**：Spec → Test → Code
- 对齐 **DEC-029**：复杂改动后需做 Codex 审计再提交

该文档用于补足“快速修复场景”的执行细则，不替代 DEC 文档。